;; ==[ CALL waitvdp ]===============================================
;; Wacht tot de VDP Klaar is.
waitvdp:
    di

    ld a, 2             ; Selecteer status register 2 (S2)
    out ($99), a    
    ld a, $8F
    out ($99), a    

WaitVDPLoop:               
    in a, ($99)         ; Lees status
    rrca                ; Bit 0 is de CE (Command Executing) flag
    jr c, WaitVDPloop   ; Wacht zolang CE=1

    xor a               ; Reset status register naar 0 (belangrijk!)
    out ($99), a
    ld a, $8F           
    out ($99), a

    ei
    ret