;; ==[ CALL MemLoadSegment ]===============================================
;; laadt het juiste memorymapper segment in het juist page. 
;;
;; INPUT:
;; - C: Page $FD = $4000+, $FE = $8000+
;; - B: Memorymapper segment (0-MEMNRBANKS)
;;
;; Gebruikt label:
;; - MEMBUFFER (34) : Tijdelijk 34 byte buffer voor het controleren. 
;;
;; GEBRUIKT:
;; - MEMNRBANKS (1) : Bevat het aantal memoryslots (max 32 = 512kb)
;; - MEMPAGE3   (1) : Bevat de memory page dat voor page 3 gerbuikt wordt. (Deze niet veranderen!)
;;
;; Foute invoer = DI/HALT

MemLoadSegment:
    ld a, c
    cp $FD
    jp z, MemLoadSegmentOk
    cp $FE 
    jr z, MemLoadSegmentOk
    ld b, 1
    jp MemLoadSegmentError

MemLoadSegmentOk:
    ld a, (MEMNRBANKS)  ; controleer de invoer.
    dec a
    cp b
    jr c, MemLoadSegmentTooHigh

    ld a, (MEMPAGE3)
    cp b
    jp z, MemLoadSegmentIsPage3

                        ; Alle invoer is goed!
    out (c), b          ; page 1: out ($FD), b  page 2: out ($FE), b
    ret

MemLoadSegmentIsPage3:
    ld a, b
    ld b, 3
    jp MemLoadSegmentError

MemLoadSegmentTooHigh:
    ld a, b
    ld b, 2

MemLoadSegmentError:
    DI          ; B = foutcode. 
    HALT        ; - 1: input-C was niet 1 of 2. (A heeft de waarde)
                ; - 2: input-B was te hoog. (A heeft de waarde)
                ; - 3: Input-B was gelijk aan Mempage3 (a heeft de waarde)


