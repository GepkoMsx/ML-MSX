;; Call logoloop
; custom for azul i guess

logoloop:
segmentloop:    
    push bc
    call HMMV       ; HL is moved to next header
    pop bc
    
    EXX             ; start with pixel work

    ld E, (HL)
    inc hl
    ld D, (HL)
    inc hl
    ld C, (HL)
    inc hl
    LD B, (HL)
    inc hl          ; automagish doorgeschoven naar volgend record
    push HL
    ld h, b
    ld l, c

; sendPixels:
;; Stuur de eigenlijke pixeldata (we gebruikgen geen HMMC.asc, omdat de header en pixeldata niet bijelkaar staat.)
;; HMMV stuurt dezelfde header naar VDP, maar dan zonder pixeldata. dat doen we hieronder. 
;; DE: aantal bytes to send (1e wordt geskipped, dus wel meetellen)
;; HL: adres

    ld a, $80+44        ; geen increment ($80) naar register 44
    out (VDPC), a
    ld a, $80+17        ; schrijf naar R17
    out (VDPC), a
    
    dec de              ; remaining bytes to send
    inc HL              ; skip 1st pixel
    ld c, VDPR

HMMCPixelLoop:
    ld a, (HL)
    out (c), a        ; VDP zet deze pixel op de volgende positie
    inc HL
    dec de
    ld a, d
    or e
    jp nz, HMMCPixelLoop
    ei
    

    pop HL
    EXX             ; terug naar HMMV loop
    djnz segmentloop
    ret